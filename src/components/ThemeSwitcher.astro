---
import Moon from "./icons/Moon.astro"
import Sun from "./icons/Sun.astro"

interface Props {
  className?: string
}
const { className } = Astro.props
---

<button id="theme-toggler" class={className} title="Toggle theme">
  <span id="icon-light" class="hidden">
    <Moon />
  </span>
  <span id="icon-dark" class="hidden">
    <Sun />
  </span>
</button>

<script is:inline>
  const $toggler = document.getElementById("theme-toggler")
  const $body = document.body
  const $iconLight = document.getElementById("icon-light")
  const $iconDark = document.getElementById("icon-dark")

  function setTheme(mode) {
    $body.classList.remove("light", "dark")
    $body.classList.add(mode)
    localStorage.setItem("theme", mode)

    $iconLight.classList.toggle("hidden", mode === "dark")
    $iconDark.classList.toggle("hidden", mode === "light")
  }

  const saved = localStorage.getItem("theme")
  const prefersDark = window.matchMedia(
    "(prefers-color-scheme: dark)"
  ).matches
  const initial = saved || (prefersDark ? "dark" : "light")
  setTheme(initial)

  $toggler.addEventListener("click", () => {
    const newTheme = $body.classList.contains("dark")
      ? "light"
      : "dark"
    setTheme(newTheme)
  })
</script>
